name: "yamllint"
description: "Run yamllint on the repository to enforce YAML style guide."
inputs:
  config_file:
    description: Path to a custom configuration file (non-default YAMLLint path)
    default: ""
    required: false
  file_or_dir:
    description: Files (or directory) to check
    default: "."
    required: false
  strict:
    description: Strict mode, causes linter warnings to be handled as errors
    default: "false"
    required: false
  YAMLLINT_VERSION:
    description: Version of yamllint to use
    default: "1.38.0"
    required: false

runs:
  using: "composite"
  steps:
    - name: Set up Python
      uses: actions/setup-python@v6
      with:
        python-version: '3.x'

    - name: Install yamllint
      shell: bash
      run: |
        pipx install --pip-args "--no-cache-dir --prefer-binary" "yamllint==${{ inputs.YAMLLINT_VERSION }}"

    - name: Run yamllint
      shell: bash
      run: |
        set -Eeuo pipefail

        # Build the command options dynamically using array for safe handling of spaces
        OPTS=(--format github)

        if [[ "${{ inputs.strict }}" == "true" ]]; then
          OPTS+=(--strict)
        fi

        if [[ -n "${{ inputs.config_file }}" ]]; then
          OPTS+=(-c "${{ inputs.config_file }}")
        fi

        set -x
        pipx run "yamllint==${{ inputs.YAMLLINT_VERSION }}" "${OPTS[@]}" "${{ inputs.file_or_dir }}"
